---
title: 进程与线程
author: someone
date: 2023-05-15 11:33:00 +0800
categories: [多线程, 线程]
tags: [多线程, 笔记]
pin: true
toc: true
math: true
mermaid: false
---
# ch2 进程与线程

## 1. 进程与线程

### 1.1 进程 process

- 程序由指令和数据组成，指令要运行，数据要读写，则必须将指令加载到CPU中，数据加载到内存中。指令运行过程中还需要用到磁盘、网络等设备。**进程就是用来加载指令、管理内存、管理IO的，即进程是操作系统进行资源分配和调度的基本单位。**
- 当一个程序被运行，从磁盘加载这个程序的代码到内存，此时我们说开启了一个进程
- 进程可以看作程序的一个实例

进程（process）是计算机中正在运行的程序实例。每个进程都有自己的内存空间、代码和数据，并在操作系统的管理下独立地运行。进程是操作系统进行资源分配和调度的基本单位。

举个例子，当你打开一个应用程序时，计算机会为该程序创建一个进程，该进程就是运行该应用程序的实例。在这个进程中，程序的代码和数据被载入内存中，CPU会按照代码的指令来执行程序。在运行过程中，进程可能会请求操作系统分配更多的内存或其他资源，操作系统会根据需要进行资源分配和管理。

### 1.2 线程 thread

- 一个进程内可以分到一到多个线程
- 一个线程就是一个指令流，将指令流中的一条条指令以一定顺序交给CPU执行
- Java 中，线程作为最小的调度单位，进程作为资源分配的最小单位。在 windows 中进程是不活动的，只是作为线程的容器。

线程（thread）是进程中的一个执行单元。一个进程可以包含多个线程，每个线程都可以独立执行不同的代码，但它们**共享该进程的内存和其他资源**。与进程不同，线程的创建和销毁都是比较轻量级的操作。

**形象比喻如下**

可以把进程看作是一栋楼房，而线程就是其中的一个房间。每个房间都可以独立地完成不同的任务，但它们共享同一栋楼房的资源，例如水电、空调等。

由于**线程共享同一个进程的内存空间**，所以线程之间的通信和同步比较容易。线程可以通过共享内存或消息传递等方式来交换数据和信息，从而协同完成复杂的任务。

### 1.3 process VS thread

- 进程相互独立，而线程存在于进程中，是进程的一个子集
- 进程拥有共享资源，如内存空间等，供其内部的线程共享
- 进程是操作系统中进行资源分配和管理的基本单位，每个进程都有自己的内存空间、代码和数据。
- 进程间通信较为复杂
    1. 同一台计算机的进程通信称为IPC(Inter-process communication)
    2. 不同计算机之间的进程通信，需要通过网络，并遵守共同的协议，例如HTTP
- 线程通信相对简单，因为线程共享内存，比如多个线程可以访问同一个共享变量。
- 轻量级上，**线程更轻量**。线程上下文切换成本低于进程，线程的创建和销毁更快，线程间的切换开销更小

## 2. 并行与并发

### 2.1 并行 parallel

并行（parallel）是指在**同一时刻执行多个任务或操作**的能力

并行（parallel）是指在同一时刻执行多个任务或操作的能力。在计算机中，通常使用并行技术来提高程序的执行效率和性能，特别是在处理大规模、复杂的问题时，使用并行技术可以大大缩短计算时间。

并行技术可以分为两种类型：数据并行和任务并行。数据并行是指将数据分成多个部分，然后同时对每个部分进行处理。例如，在图像处理中，可以将一张大图分成多个小块，然后在多个处理器上同时对每个小块进行处理。任务并行是指将任务分成多个子任务，然后同时执行这些子任务。例如，在分布式系统中，可以将一个复杂的任务分成多个子任务，然后在多个计算节点上同时执行这些子任务。

并行技术需要具备良好的并发控制机制，以保证多个任务或操作之间的正确协同和同步。在实际应用中，通常采用多线程、多进程、多机器等技术来实现并行。同时，还需要考虑硬件和软件的支持，例如多核处理器、高速缓存、并行编程语言和库等。

### 2.2 并发 concurrent

并发（concurrency）是指在**同一时间间隔内执行多个任务或操作**的能力

并发（concurrency）是指在**同一时间间隔内执行多个任务或操作**的能力。在计算机中，并发常用于多用户、多任务、多线程等场景，用于提高计算机的资源利用率和处理效率。

与并行不同的是，并发是指多个任务或操作在时间上有重叠，但是在同一时刻只能执行其中的一个，因此它们需要通过切换执行上下文来共享CPU资源。例如，在操作系统中，多个进程或线程可以同时运行，但是在同一时刻只有一个进程或线程在执行，因为CPU资源是被轮流分配的。

并发技术需要考虑多个任务或操作之间的同步和互斥，以保证它们之间的正确协同。例如，在多线程编程中，需要使用锁、信号量、条件变量等机制来控制多个线程之间的同步和互斥。同时，还需要考虑线程安全和死锁等问题，以保证程序的正确性和稳定性。

总的来说，并发和并行是两个相关但又不同的概念，都是用于提高计算机的资源利用率和处理效率的重要技术。

单核 cpu 下，线程实际还是 串行执行 的。操作系统中有一个组件叫做任务调度器，将 cpu 的时间片（windows
下时间片最小约为 15 毫秒）分给不同的程序使用，只是由于 cpu 在线程间（时间片很短）的切换非常快，人类感
觉是 同时运行的 。总结为一句话就是： 微观串行，宏观并行 ，

一般会将这种 **线程轮流使用 CPU 的做法**称为并发 concurrent

引用 Rob Pike 的一段描述：

- 并发（concurrent）是同一时间应对（dealing with）多件事情的能力
- 并行（parallel）是同一时间动手做（doing）多件事情的能力

************形象比喻如下************

- 家庭主妇做饭、打扫卫生、给孩子喂奶，她一个人轮流交替做这多件事，这时就是**并发**
- 家庭主妇雇了个保姆，她们一起这些事，这时既有**并发**，也有**并行**（这时会产生竞争，例如锅只有一口，一
个人用锅时，另一个人就得等待）
- 雇了3个保姆，一个专做饭、一个专打扫卫生、一个专喂奶，互不干扰，这时是**并行**

### 2.3 Parallelism VS concurrency

并发（Concurrency）和并行（Parallelism）都是用于提高计算机的资源利用率和处理效率的重要技术，但是它们有着本质的区别。

**并发是指多个任务或操作在时间上有重叠，但是在同一时刻只能执行其中的一个**，因此它们需要通过切换执行上下文来共享CPU资源。例如，在操作系统中，多个进程或线程可以同时运行，但是在同一时刻只有一个进程或线程在执行，因为CPU资源是被轮流分配的。并发技术需要考虑多个任务或操作之间的同步和互斥，以保证它们之间的正确协同。

**并行是指在同一时刻执行多个任务或操作的能力**。在计算机中，通常使用并行技术来提高程序的执行效率和性能，特别是在处理大规模、复杂的问题时，使用并行技术可以大大缩短计算时间。并行技术可以分为两种类型：数据并行和任务并行。数据并行是指将数据分成多个部分，然后同时对每个部分进行处理。任务并行是指将任务分成多个子任务，然后同时执行这些子任务。

总的来说，简单地说，**并发是关注在时间上多个任务如何交替执行，而并行是关注在空间上多个任务如何同时执行**。并发通常应用于多任务、多用户、多线程等场景，而并行通常应用于处理大规模、复杂的问题。

**Q 什么叫做线程的上下文切换**

**Ans** 

线程是在进程中执行的独立执行流。在操作系统中，多个线程可能会在同一时间内运行，从而实现并发执行。

当一个线程需要等待某些操作完成或者发生某些事件时，操作系统会将其暂停，并保存当前线程的上下文信息（比如程序计数器、寄存器、堆栈等）到内存中。这个过程被称为**线程的上下文切换**。

接下来，操作系统会从调度队列中选择一个可用的线程，并将其上下文信息从内存中读入CPU寄存器，让这个线程继续执行。这个过程可能会发生多次，每次上下文切换都需要操作系统消耗一定的资源，所以合理地控制线程的数量和上下文切换的次数对系统的性能是非常重要的。
